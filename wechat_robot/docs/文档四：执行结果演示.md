# 文档四：执行结果演示

> 21301114 俞贤皓

## 0. 目录

* [1. 如何使用本系统](#1-如何使用本系统)
* [2. 效果图](#2-效果图)
* [3. 关键代码](#3-关键代码)

## 1. 如何使用本系统

* 公众号：咸鱼鱼的Blog

  * 如果没反应的话，可能是后端没开。阿里云便宜服务器配置太差，不够稳定。
  * 可以直接打我电话开后端TAT，18105028615

* 进入聊天页面后，可以输入 `help` 查看手册

* Examples

  ```bash
  help
  # 详细手册请见 文档三
  
  query --city 南京 --page 2
  query --sort-new --page 1
  query --sort-salary --sort-new --page 1
  query --city 南京 --company 谷雅丰帝国
  query --page 3 --sort-salary --company 谷雅丰帝国
  query --page 2 --company 未来科技有限公司
  query --page -1
  query --page 100
  query --page 3 --sort-new
  query --position Up主
  
  commit guuu帝国 南京 南京皇帝 19260817
  
  group-commit guuu帝国 南京 南京皇帝 192608171 guuu帝国 南京 南京皇帝 192608172 guuu帝国 南京 南京皇帝 192608173 guuu帝国 南京 南京皇帝 192608174 guuu帝国 南京 南京皇帝 192608175 guuu帝国 南京 南京皇帝 192608176 guuu帝国 南京 南京皇帝 192608177 guuu帝国 南京 南京皇帝 192608178 guuu帝国 南京 南京皇帝 192608179 guuu帝国 南京 南京皇帝 1926081710
  # 连续添加了10个记录
  # 如果想从文件导入记录的话，需要在后台进行导入，因为个人微信号无法传文件，企业微信号才可以
  ```

## 2. 效果图

* `help`
  * ![image-20240404173058131](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404173058131.png)
* `commit` & `group-commit`
  * ![image-20240404173120424](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404173120424.png)
* `query`
  * ![image-20240404173258134](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404173258134.png)
  * ![image-20240404173309980](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404173309980.png)
  * ![image-20240404173317354](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404173317354.png)
  * ![image-20240404173605762](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404173605762.png)
  * ![image-20240404173718146](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404173718146.png)
* 未知命令
  * ![image-20240404173824953](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404173824953.png)
* 爬虫检测
  * 如果一个用户在 **30s内提交了超过30条信息**，那么这个用户就会被永久添加到作弊用户/爬虫名单中。
    * 在数据库中储存一个队列，基于队列对用户提交记录进行判断。

  * 首先，查看用户状态，当前用户状态为正常（默认值 = 0）
    * ![image-20240404175653093](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404175653093.png)

  * 然后，模拟爬虫，对系统进行刷屏
    * ![image-20240404175538724](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404175538724.png)

  * 然后发现某个时刻，系统不再回应
    * ![image-20240404175639641](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404175639641.png)

  * 进入后台，发现用户状态变成了爬虫
    * ![image-20240404175704008](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404175704008.png)
    * 和预计一致，用户状态变成爬虫之后，系统会无视其所有请求

  * 在后台，手动将用户状态修改回正常值 0
    * ![image-20240404175805471](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404175805471.png)
    * ![image-20240404175825261](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404175825261.png)

  * 又可以重新接受信息
    * ![image-20240404175841871](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404175841871.png)


## 3. 关键代码

* 此处只列出部分代码，具体代码详见 `wechat_robot/main/`

### 3.1 路由

* ![image-20240404174144474](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404174144474.png)

### 3.2 入口

* ![image-20240404174135257](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404174135257.png)

### 3.3 词法分析器

* 入口
  * ![image-20240404174219619](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404174219619.png)
* 正则表达式
  * ![image-20240404174233129](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404174233129.png)

### 3.4 部分服务

* 服务列表
  * ![image-20240413151407679](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240413151407679.png)
* get_offer()
  * ![image-20240404174353595](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404174353595.png)
* list_offers()
  * ![image-20240404174335110](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404174335110.png)
* batch_create_offers()
  * ![image-20240413151432487](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240413151432487.png)
* 部分用户相关API
  * ![image-20240404174540001](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404174540001.png)
* 反爬虫相关代码
  * ![image-20240404180314162](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404180314162.png)
  * ![image-20240404180606882](./%E6%96%87%E6%A1%A3%E5%9B%9B%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA/image-20240404180606882.png)